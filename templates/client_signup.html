{% extends "base.html" %}

{% block title %}Join as Client - CompliancePro360{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
    <div class="max-w-md w-full">
        <div class="text-center mb-8">
            <div class="inline-flex items-center gap-2 mb-4">
                <div class="w-12 h-12 bg-gradient-to-br from-blue-600 to-blue-800 rounded-lg flex items-center justify-center">
                    <i data-lucide="user-check" class="w-7 h-7 text-white"></i>
                </div>
                <span class="text-3xl font-bold text-gray-900">Join as Client</span>
            </div>
            <p class="text-gray-600">Create your account to access your compliance dashboard</p>
        </div>

        <div class="bg-white rounded-xl shadow-xl p-8">
            <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <p class="text-sm text-blue-800">
                    <strong>Invited by:</strong> {{ invitation.practitioner_name if invitation else 'Unknown' }}<br>
                    <strong>Company:</strong> {{ invitation.company_name if invitation else 'Your Company' }}
                </p>
            </div>

            <form id="signupForm" class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">First Name *</label>
                        <input type="text" id="first_name" required
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Last Name *</label>
                        <input type="text" id="last_name" required
                            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                    <input type="email" id="email" required
                        value="{{ invitation.client_email if invitation else '' }}"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Create Password *</label>
                    <input type="password" id="password" required minlength="8"
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <div id="error-message" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm"></div>

                <button type="submit" class="w-full btn btn-primary py-3 text-lg">
                    Create Account
                </button>
            </form>
        </div>
    </div>
</div>

<script>
document.getElementById('signupForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = {
        first_name: document.getElementById('first_name').value,
        last_name: document.getElementById('last_name').value,
        email: document.getElementById('email').value,
        password: document.getElementById('password').value,
        invitation_token: '{{ invitation.token if invitation else '' }}'
    };
    
    const errorDiv = document.getElementById('error-message');
    errorDiv.classList.add('hidden');
    
    try {
        const response = await fetch('/api/clients/signup', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(formData)
        });
        
        const data = await response.json();
        
        if (data.success) {
            alert('Account created successfully! Redirecting to login...');
            window.location.href = '/login';
        } else {
            errorDiv.textContent = data.error || 'Failed to create account';
            errorDiv.classList.remove('hidden');
        }
    } catch (error) {
        errorDiv.textContent = 'An error occurred. Please try again.';
        errorDiv.classList.remove('hidden');
    }
});
</script>
{% endblock %}
